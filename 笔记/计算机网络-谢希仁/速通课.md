# 1. 引言

## 1.1 概述

1. 组成：
   1. 组成部分视角：
      1. 硬件：主机，通信链路，交换设备，通信设备
      2. 软件：用户使用的软件
      3. 协议：网络传输数据时需要遵守的规范
   2. 工作方式视角：
      1. 边缘部分：用户使用部分
      2. 核心部分：中心网络、连接网络的路由器
   3. 功能组成视角
      1. 通信子网：由传输介质、通信设备、相应的网络协议组成，**传输**
      2. 资源子网：实现资源共享功能的设备及软件，**包装**
2. 功能
   1. 数据通信：传输信息。**最基本和最重要的部分**
   2. 资源共享：使计算机网络分工协作
   3. 分布式处理：将任务分配给网络中其他的计算机系统，**分布式**
   4. 提高可靠性：各台计算机通过网络互为替代机
   5. 负载均衡：均匀分配工作
3. 分类
   1. 分布范围分类：广域网、城域网、局域网、个人区域网
   2. 传输技术分类：
      1. 广播式网络
      2. 点对点网络：每条物理线路连接一对网络
   3. 拓扑结构
      1. 总线型
      2. 星形
      3. 环形
      4. 网状形
   4. 交换技术
      1. 电路交换：发送接收处有专用通路进行数据传输
      2. 报文交换：数据加上地址来进行转发
      3. 分组交换：将报文切分为小块传输
   5. 传输介质
      1. 有线
      2. 无线
4. 性能指标
   1. 时延
      1. 发送时延：第一个到最后一个比特发送完毕所需的时间
      2. 传播时延：一个比特从链路一端到另一端的时间
      3. 处理时延：路由器处理的时延
      4. 排队时延：进入路由器等待处理的时间s
      5. 往返时延：*发送端发送*到*发送端收到接收端确认*的时间
   2. 吞吐量：单位时间通过某个网络/接口的数据量
   3. 速率：主机在数字信道上传送数据的速率，最高数据率称为 **带宽**
   4. 时延带宽积：发送端第一个比特到达终点时，发送端发出了多少比特。$时延带宽积=传播时延\times信道带宽$

## 1.2 结构

1. 分层结构的基本原则:
   1. 每层实现一种相对独立的功能,降低大系统的复杂度。各层之间界面自然清晰，易于理解，**相互交流尽可能少**。
   2. 各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术实现
   3. **保持下层对上层的独立性**，上层单向使用下层的服务
   4. 两个主机通信时，同一层 *逻辑* 上有一条直接信道，显示为不经过下层
2. 协议、接口、服务
   1. 协议：规则的集合
      1. 语法：传输数据的格式。长度、开头等
      2. 语义：要完成的功能。
      3. 同步：各种操作的时序关系。
   2. 接口：相邻两层交换信息的连接点
   3. 服务：下层为紧邻上层提供的功能
      1. 面向连接服务/无连接服务
         1. 面向连接：先建立连接、分配资源、进行数据传输、结束后释放连接
         2. 无连接：通信双方不先建立连接，发送数据时可直接发送
      2. 可靠/不可靠
         1. 可靠：网络具有纠错、检错机制，保证数据正确可靠
         2. 不可靠：网络的正确性、可靠性由应用/用户保证
      3. 应答/无应答
         1. 有应答：接收方收到后给发送方给出相应的应答
         2. 无应答：反之
   4. ***协议和服务在概念上不一致，前者控制对等实体之间的通信规则，后者借助接口从下层向上层提供***
3. ISO/OSI模型
   1. 物理层：
      1. 传输单位：**比特**
      2. 任务：透明的传输比特流
      3. 功能：在物理媒体上为数据端设备透明地传输原始比特流
   2. 数据链路层：
      1. 传输单位：**帧**
      2. 任务：将网络层传来的 **IP数据报** 组装成帧
      3. 功能：组装帧、差错控制、流量控制、传输管理
   3. 网络层：
      1. 传输单位：**数据报**
      2. 任务：把网络层的分组从源端传到目的端
      3. 功能：为分组交换网上的不同主机提供通信服务
   4. 传输层：
      1. 传输单位：**TCP报文段/UDP用户数据报**
      2. 任务：负责主机中两个进程之间的通信
   5. 会话层：允许不同主机上各个进程之间的会话
   6. 表示层：处理两个通信系统中交换信息的表示方式
   7. 应用层：用户界面
4. TCP/IP模型
   1. 应用层
   2. 传输层
   3. 网际层
   4. 网络接口层
5. 五层架构的网络模型：
   1. 应用层
   2. 传输层
   3. 网际层
   4. 数据链路层
   5. 物理层

# 2. 物理层

## 2.1. 通信基础

1. **概念**
   1. 数据:传送信息的实体
   2. 信号:数据的电气/电磁表现
   3. 码元:用固定时长的信号波形表示一个K进制数字,代表不同离散数值的基本波形
   4. 信源:产生/发送数据的源头
   5. 信道:信号传输媒介
   6. 信宿:接受数据的终点
2. **通道:**
   1. 单工通道:单向传输,*一条信道*
   2. 半双工通道:双向传输,但不可同时双向,*两条信道*
   3. 全双工通道:双向传输,可同时双向,*两条信道*
3. **信道的极限容量:** 信道的最高码元传输速率/信道的极限信息传输速率

## 2.2 奈奎斯特定理/香农定理

1. **奈奎斯特定理:**
   1. **规定:** 在 *理想低通* (没有噪声,带宽有限) 的信道中,为了避免码间串扰,*极限码元传输速率*为 **2W波特**
   2. **公式:** $极限数据传输速率 = 2W log_2 V$
      1. W: *理想低通信道的带宽*
      2. V: *每个码元离散电平* 的数目
      3. 单位:b/s
   3. **结论:**
      1. 在任何信道中,码元传输速率是有上限的,若传输速率超过此上限,就会出现更严重的的码间串扰问题,使接收端不可能完全正确识别码元
      2. 信道的频带越**宽**,就可用更**高**的速率进行码元的有效传输
      3. 该准则只给出了**码元传输速率的限制**,未给出**信息传输速率的限制**(未对一个码元可以对应多少个二进制位给出限制)
2. **香农定理:**
   1. **意义:** 给出了 *带宽受限且有高斯白噪声干扰* 的信道的**极限数据传输速率**,当用此速率进行传输时,可以做到不产生误差
   2. **公式:** $信道的极限传输速率 = W log_2(1+\frac{S}{N})$
      1. W:带宽
      2. $\frac{S}{N}$ :信噪比
   3. **结论:**
      1. 信道的带宽越大或信道的信噪比*越大*,信息的极限传输速率*越高*
      2. 对一定的传输带宽和一定的信噪比,信息的传输速率的上限是确定的,只要速率低于极限传输速率,就总有某方法实现无差错的传输

## 2.3 编码与调制

1. **编码:** 数据变换为数字信号的过程
   1. 常见编码:![1716119125292](image/速通课/1716119125292.png)
      1. 归零编码: 1先高电平，结束时低电平；0保持低电平
      2. 非归零编码: 1高电平,0低电平
      3. 反向非归零编码: 先正常输出,是1则不变,是0则改变
      4. 曼彻斯特编码:1先高电平后低电平,0先低电平后高电平
      5. 差分曼彻斯特编码:类似于反向非归零编码,(反向曼彻斯特编码)
2. **调制:** 数据变换为模拟信号的过程
   1. 常见的几种调制:
      1. 调幅(ASK 幅移键控):0则平,1则有幅度
      2. 调频(FSK 频移键控):0低频,1高频
      3. 相位调制(PSK 相位键控):0正向,1反向
3. **模拟数据编码为数字信号:**
   1. 采样:模拟信号转换为数字信号时,采样频率必须大于等于最大频率的二倍,才能保证无损
   2. 量化:把电平幅值按照一定的分级标度转换为对应的数字值并取整数
   3. 编码:把量化结果转换为与之对应的二进制编码

## 2.4 电路交换/报文交换/分组交换

1. **电路交换:**
   1. 要求:两个节点之间必须先建立一条专用的物理通信路径,直到通信结束后才被释放
   2. 过程:
      1. 建立连接
      2. 数据传输
      3. 连接释放
   3. 优点:
      1. 通信时延小
      2. 有序传输:通信按照顺序传送数据
      3. 没有冲突:所有用户信道不同,不存在争用信道问题
      4. 适用范围广
      5. 实时性强
      6. 控制简单
   4. 缺点:
      1. 建立时间长
      2. 线路独占
      3. 使用效率低
      4. 灵活性差
      5. 难以规格化
   5. 数据传送的特点:比特流直达终点
2. **报文交换:**
   1. 特点:
      1. 数据交换的单位是*报文*, 报文携带目标地址,源地址等信息
      2. 报文交换在交换节点中采用*存储转发*的传输方式
   2. 优点:
      1. 无需建立连接
      2. 动态分配线路
      3. 提高线路的可靠性:如果某条线路的设备故障,则可以换一条
      4. 提高线路利用率
   3. 缺点:
      1. 要经过存储转发过程,时延较高
      2. 需要大量的缓存
3. **分组交换:**
   1. 特点:
      1. 采用存储转发的方式
      2. 限制了每次传输数据块大小的上限,分割数据块
   2. 优点:
      1. 简化了存储管理
      2. 不需要
   3. 缺点
      1. 需要传输额外的信心量,降低了通信的效率
      2. 可能出现失序/丢失/重复分组,需要对其进行重排
   4. 方式
      1. 数据报(无连接)
         1. 过程
            1. 在网络层加上地址等控制信息后形成的数据报
            2. 中间节点储存分组,找到最佳路由,转发
            3. 不同的分组可以走不同的路径,也可以按不同的顺序到达目的节点
         2. 优点:
            1. 不需要建立连接
            2. 不保证可靠性
            3. 需要排队
            4. 对故障的适用能力强
            5. 不独占链路
      2. 虚电路(面向连接)
         1. 特点:将数据报和电路交换的方式结合
         2. 过程:建立一条逻辑上相连的虚电路
            1. 虚电路建立
            2. 数据传输
            3. 虚电路释放
         3. 特点:
            1. 建立和拆除需要时间开销
            2. 提供了可靠的通信功能
            3. 虚电路易遭到破坏
            4. 分组首部只包含*虚电路标识符*

## 2.5 传输介质/物理层设备

1. 传输介质
   1. 双绞线
      1. 屏蔽双绞线
      2. 无屏蔽双绞线
   2. 同轴电缆
      1. 基带同轴电缆
      2. 宽带同轴电缆
   3. 光纤
      1. 单模光纤
      2. 多模光纤
   4. 无线传输介质
      1. 无线电波
      2. 微波/红外线/激光
2. 物理层设备:
   1. 中继器:信号整形、放大、转发
      1. 目的:消除信号的失真和衰减,使信号的波形和强度达到做需要的要求,进而扩大网络传输距离
      2. 原理:信号再生
   2. 集线器(hub):多端口中继器
      1. 若有2/2+个端口输入,则会有冲突,致使数据无效

## 2.6 接口特性

1. 机械特性:接口的形状/尺寸引脚数目,排列,固定和锁定装置
2. 电气特性:接口线缆的各条线上的电压范围
3. 功能特性:某条线上某一电平表示何种意义
4. 过程特性:(规格特性)指明不同功能的各种可能事件的出现顺序

# 3. 数据链路层

## 3.1 功能

1. **为网络层提供服务**:
   1. 无确认的无连接服务:
      1. 源机器发送数据帧不需要先建立链路连接(无连接)
      2. 目的机器收到数据帧*不需发回确认*(无确认)
      3. 对于丢失帧,数据链路层不负责重发而交给上层处理
   2. 有确认的无连接服务
      1. 源机器发送数据帧不需要先建立链路连接(无连接)
      2. 目的机器收到数据帧*需发回确认*(有确认)
      3. 源机器在规定时间内未收到确认则重传
   3. 有确认的面向连接服务
      1. 过程
         1. 建立数据链路
         2. 传输帧
         3. 释放数据链路
      2. 特点:目的机器每一帧都要给出确认,原机器收到确认才发送下一帧
      3. **连接一定要有确认,不存在无确认的面向连接服务**
2. 帧定界、帧同步、透明传输
3. 流量控制
4. 差错控制

## 3.2 组帧

1. **字符计数法**：帧头部使用一个计数字段来表明帧内字符数
   1. 目的：结点的数据链路层收到字节计数值时，就可以知道后面跟随的字节数，从而确定帧结束的位置
   2. 缺点：若帧头部计数字段错误，则整个传输失效。
   3. ![1716199939071](image/速通课/1716199939071.png)
2. **字符填充的首位定界符法**
   1. 概念：使用特定字符来定界一帧的开始与结束，若特殊字符出现与帧之中，则填充转义字符(ESC)
   2. ![1716208988632](image/速通课/1716208988632.png)
3. **零比特填充的首位标志法**
   1. 方式:用 `01111110`来标志一帧的开始和结束
   2. 行为:
      1. 发送:若信息中有5个连续的1时,则向后面填充一个0
      2. 接受:若信息中有五个连续的1时,则删除后面的一个0
   3. ![1716209253553](image/速通课/1716209253553.png)
4. **违规编码法**
   1. 使用不属于规定编码的方式来进行标记首位
   2. 比如曼彻斯特编码中,编入一个"高-高电平"数据对

## 3.3 差错控制

1. **检错编码**：
   1. 奇偶校验码
      1. 奇校验码：附加一个校验元后，码长为n的码字中1的个数为*奇*数
      2. 偶校验码：附加一个校验元后，码长为n的码字中1的个数为*偶*数
   2. 循环冗余码：任何一个由二进制数位串组成的代码都可以与一个只含有01两个系数的多项式建立一一对应关系
      1. 取n位位串G(x)，源数据在尾部补n-1个0后，作商取余数，添加与数据尾部
      2. ![1716209253562](image/速通课/1716209253562.png)
   3. 纠错编码(海明码)
      1. 构成

         1. 设n为有效信息位数，k为校验位的位数，则有$n+k\le2^k-1$
         2. 校验位$P_n$在海明位号为$2^{n-1}$的位置上，其余各位为信息位
      2. 校验位$P_n$：为可由该位组成的所有位的异或积。
      3. 检验码$S_n$：为$P_n$与其组成的所有位的异或积
      4. 出错位：为$S_nS_{n-1}……S_1 $表示的二进制数字

         | 二进制位 | 111     | 110     | 101     | 100     | 011     | 010     | 001     |
         | -------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- |
         | 海明码位 | $H_7$ | $H_6$ | $H_5$ | $H_4$ | $H_3$ | $H_2$ | $H_1$ |
         | 对应位   | $D_4$ | $D_3$ | $D_2$ | $P_3$ | $D_1$ | $P_2$ | $P_1$ |


         - $P_1=D_1\bigoplus D_2\bigoplus D_4$
         - $S_1=P_1\bigoplus D_1\bigoplus D_2\bigoplus D_4$

## 3.4 流量控制/可靠传输机制

1. **滑动窗口机制**:
   1. 停止-等待流量控制基本原理
      1. 发送方每发送一帧,然后等待接收方的应答信号,而后才能发送下一帧
      2. 接收方每接受一帧,然后发送应答信号,表示可接受下一帧
   2. 多帧滑动窗口与后退N帧协议(**GBN**)
      1. 接收方检测出失序的信息帧后,要求发送方重发最后一个正确接收的信息帧之后所有未被确认的帧
   3. 多帧滑动窗口与选择重传协议(**SR**)
      1. 当接收方检测出错时,发送错误应答的,数据链路层继续接受并缓存后续内容
      2. 发送方接收错误应答,重传错误帧
      3. 接收方数据链路层接收重传的帧,将其与超时间隔中部分向上传给网络层

## 3.5 信道划分介质访问控制

1. 信道划分介质访问控制
   1. **频分多路复用**:
      1. 将多路基带信号调制到不同频率载波上,再叠加形成一个复合信号的多路复用技术
   2. **时分多路复用**:
      1. 将一条物理信道按时间分成若干时间片,轮流给多个信号使用
   3. **波分多路复用**:
      1. 使用不同波长的光信号,在一条光纤上传输多组数据
   4. **码分多路复用**:
      1. 采用不同编码来区分各路原始信号
      2. 示例
         1. 假设A发送S,B发送T,注意S/T等长为n
         2. 则信道上为$S-T$
         3. 则A发送$S*(S-T)/n$
2. 随机访问介质访问控制
   1. **ALOHA协议**
      1. 纯:发送数据时不进行任何检测就发送数据,若接收方不确认,则重发
      2. 时隙:每个时隙开始时才能发送一个帧,减少数据产生冲突的可能性,提高信道的利用率
   2. **CSMA协议**:一个结点发送数据首先侦听信道
      
      |信道状态|1-坚持|非坚持|p-坚持|
      |-|-|-|-|
      |空闲|立即发送数据|立即发送数据|以概率p发送数据,或推迟到下一个时隙|
      |忙|继续坚持侦听|放弃侦听,等一个随机时间再侦听|持续侦听,直到信道空闲|

   1. **CSMA/CD协议**:载波侦听多路访问/碰撞检测
      1. 过程
         1. 先听后发:先获得分组,等到信道空闲边发送
         2. 边听边发:发送时持续监测信道,
         3. 冲突停发:若检测到碰撞,则中止发射,发送拥堵信号给所有用户
         4. 随机重发:执行指数退避算法,等待时间返回检测过程
      2. 在A发送帧后至多经过时间$2\tau$就能知道所发送的帧是否发生碰撞,该往返时间又称争用期
      3. 为了确保发送站可以同时能检测到可能存在的碰撞,则所有数据帧必须大于一个最小帧长
         1. $$最小帧长=总线传播时延\times数据传输速率\times2$$
         2. 默认时长为$51.2\mu s$
      4. 二进制指数退避算法
         1. 目的:避免两个站点同时再次发送,导致无休止的冲突
         2. 过程:
            1. 确定基本退避时间,一般是$2\tau$
            2. 定义参数k,重传次数,$k=min[重传次数,10]$
            3. 取离散整数集合$[0,1,……,2^k-1]$中随机取出r,等$2r\tau$重传
            4. 当重传16次仍旧不成功,则认为该帧无法正确发出
   2. **CSMA/CA协议**:
      1. 应用于无线局域网
         1. 因其碰撞检测成本过高
         2. 存在无法听到的站点的问题
      2. 过程
         1. 检测数据发送且信道空闲,发送数据帧
         2. 否则执行退避算法,选取随机回退值,当不忙的时候开始退避计时器倒计时,到零则发送
         3. 发送站得到确认.若未得到,则用上一步骤重传
3. 轮询访问介质访问控制
   1. 令牌传递协议:
      1. 用户不能随机发送信息,需要通过集中控制的监控站,以循环的方式轮询每个节点,再决定信道的分配
      2. 一个令牌在各节点间以某个固定次序交换令牌

## 3.6 局域网/广域网

1. 局域网的基本概念和体系结构
   1. 主要拓扑结构:星形/环形/总线形
   2. 传输介质:双绞线/铜揽
   3. 介质访问控制控制方法
      1. CSMA/CD:总线型局域网
      2. 令牌总线:总线型局域网
      3. 令牌环:环形局域网
   4. 局域网标准:以太网与IEEE 802.3
      1. 特点
         1. 逻辑上采用总线形的拓扑结构,**多点接入技术**
         2. 所有计算机共享一条总线,信息以广播方式发送
         3. 协议主要在数据链路层和物理层
         4. 强调数据传输
      2. 简化通信
         1. 采用无连接的方式,不对数据帧标号,不要求接收方确认
         2. 采用曼彻斯特编码
      3. 网卡:
         1. 又称"网络适配器","网络接口卡"
         2. 介质访问控制地址(MAC):每个网卡的唯一的一个代码,用于控制主机在网络上的通信
         3. 以太网的MAC帧![12](image/速通课/12.png)
            1. 地址:通常使用6字节(48bit)地址(MAC地址)
            2. 数据:46-1500字节,以太网帧必须满足最小64字节
      4. 高速以太网:
         1. 100BAST-T以太网:全双工方式和半双工方式,在前者下不使用CSMA/CD协议
         2. 吉比特以太网:同上
         3. 10吉比特以太网:只工作在全双工下
2. 广域网:
   1. 基本概念:覆盖很广的长距离网络,局域网可以通过广域网与另外一个相隔很远的局域网通信
   2. 组成:结点交换机+链路
   3. 特点:
      1. 协议主要在网络层
      2. 强调数据传输
      3. 使用mac地址即可通信
   4. 协议:PPP协议和HDLC协议(数据链路层控制协议)
      1. PPP协议:
         1. 组成:
            1. 链路控制协议(LCP):扩展链路控制协议,用于建立,配置,测试和管理数据链路
            2. 网络控制协议(NCP):配置不同的网络层协议,为网络层协议建立和配置逻辑连接
            3. 封装方法:将IP数据报封装到串行链路的方法,长度受最大传送单元限制
         2. 过程:
            1. 线路处于*静止状态*时,不存在物理层连接
            2. 线路检测到载波型号时,建立物理连接,线路变为*建立状态*
            3. LCP开始选项商定,成功后进入*身份验证状态*
            4. 验证通过,进入*网络状态*
            5. NCP配置网络层,成功后进入*打开状态*,开始数据传输
            6. 数据传输结束后转为*终止状态*,
            7. 载波停止后进入*静止状态*
         3. 特点:
            1. 不使用序号和确认机制,只保证无差错接受(通过硬件进行CRC检验)
            2. 端到端的差错检测由高层协议负责
            3. **面向字节,当信息字段和标志字段出现一致的比特组合,采用字节填充法**
      2. HDLC协议:
         1. 站类型
            1. 主站:控制链路的操作,发出的帧为命令帧
            2. 从站:受控于主站,发出的帧为响应帧
            3. 复合站:可以发出命令帧和响应帧
         2. 数据操作方式
            1. 正常响应状态:
               1. 非平衡结构操作方式
               2. 主站向从站传输数据,从站响应传输.*从站只有收到许可才可响应*
            2. 异步平衡方式:
               1. 平衡结构操作方式
               2. 每个复合站都可以进行对另一站的数据传输
            3. 异步响应方式:
               1. 非平衡结构操作方式
               2. 从站未得到主站许可,也可进行传输
         3. 特点:
            1. 信息帧使用编号和确认机制,能够提供可靠传输
            2. **面向比特**

## 3.7 设备

1. 网桥:
   1. 作用:
      1. 将多个以太网进行连接,形成覆盖范围更大的以太网.
      2. 原来的每个以太网称为一个网段(LAN)
   2. 工作位置:链路层MAC子层
      1. 使得以太网各网段成为隔离开的碰撞域
   3. 流程
      1. 网桥接受网络1发送的数据帧,检查数据帧中的地址
         1. 若为网络2,则转发给网络2
         2. 若为网络1,则将其丢弃
   4. 基本特点
      1. 具备寻址和路径选择的能力,确定帧的传输方向
      2. 从原网络接受帧,以目的网络的介质访问控制协议向目的网络转发该帧
      3. 可使用不同的物理层,可互联不同类型的局域网
   5. 转发规则:
      1. 原LAN与目的LAN相同,则丢弃
      2. 原LAN与目的LAN不同,则转发
      3. 目的LAN未知,则扩散